# Binder's Parking project

Welcome.

This is a small demo for a parking lot management system, which has (or will have) the following features:

* Account creation and authentication
* Vehicle access control and billing
* Gemma AI-driven chatbot

## Techincal Characteristics

**Note:** This is still a work in progress.

This solution has a web api created in Python + Flask, and uses SQLAlchemy + Flask-Migrate + Psycopg to access and seed a Postgres database.

The API's authentication is done using Flask JWT Extended + Argon2 for password hashing.

### Setup

First, you must create a .env file inside **/api** folder, with the following structure:

```shell
DATABASE_URL=postgresql+psycopg://your-username:your-password@db:5432/your-database-name
SQL_HOST=db
SQL_PORT=5432
DATABASE=postgres
JWT_SECRET_KEY=insert-a-super-secure-secret-for-your-tokens-here
FLASK_APP=app/manage.py
FLASK_ENV=production
```

**Note:** your database connection info here should match the ones on db section inside docker-compose.yml file. The SQL_HOST variable should not be changed, since it's referring to docker's database hosting image.

Then, ensure you have Docker installed and running, and run the following commands at project's root (where docker-compose.yml resides):

```shell
docker-compose build
docker-compose up
```

If everything goes well, you should be able to reach the API at `http://localhost:5000`.

### API

It currently has the following endpoints available:

| Method | Endpoint       | Description                  | Body                            | Return Codes  | Requires Auth |
| ------ | -------------- | ---------------------------- | ------------------------------- | ------------- | ------------- |
| POST   | /auth/register | Create a new user            | { "email": "", "password": "" } | 201, 409      | No            |
| POST   | /auth/login    | Authenticate user            | { "email": "", "password": "" } | 200, 401      | No            |
| GET    | /park/         | List all parking history     |                                 | 200, 401      | Yes           |
| POST   | /park/arrive   | Register a vehicle arrival   | { "plate": "" }                 | 201, 400, 409 | No            |
| POST   | /park/depart   | Register a vehicle departure | { "plate": "" }                 | 200, 400, 404 | No            |

For the endpoints that requires auth, include the Bearer token generated by the /auth/login endpoint in the authentication header, or you'll get a `401 - Unauthorized` response.
